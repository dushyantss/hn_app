import 'package:flutter_test/flutter_test.dart';
import 'package:hn_app/src/article.dart';
import 'package:http/http.dart' as http;

void main() {
  test('parses topstories.json', () {
    const jsonString =
        '[19347443,19346321,19346985,19345739,19336236,19340234,19346295,19347597,19346342,19347041,19340667,19340457,19344843,19347343,19345462,19346017,19342794,19347209,19342178,19346958,19346148,19344682,19346751,19339748,19344635,19346970,19344660,19332674,19346105,19335090,19334245,19343398,19342503,19342184,19339330,19344764,19346819,19335530,19344327,19345461,19346433,19346012,19336652,19344937,19343044,19346878,19345635,19344181,19342135,19344714,19341458,19344146,19343521,19339902,19346076,19334417,19337164,19344881,19338192,19337789,19347118,19333600,19336754,19340050,19338209,19341079,19337630,19322448,19344292,19340076,19347317,19334704,19345820,19343506,19341061,19337638,19344179,19338822,19346526,19335363,19330812,19346888,19337466,19331307,19338878,19346380,19345755,19334909,19332935,19340954,19337527,19340638,19337456,19336077,19336724,19336935,19339240,19339569,19342544,19335204,19323032,19333479,19345098,19343960,19325361,19344238,19328085,19336411,19339544,19335674,19334543,19336543,19340267,19345814,19321291,19336705,19332156,19342624,19338830,19338078,19321775,19346262,19336925,19340316,19339423,19333239,19345366,19329199,19344222,19335269,19337153,19320217,19344729,19340843,19336680,19338545,19345119,19343624,19330024,19337841,19339750,19334699,19336667,19331331,19337490,19324670,19345743,19327043,19325548,19335011,19334065,19343729,19333402,19334019,19339039,19340492,19335295,19336606,19339792,19328451,19325805,19334940,19328130,19321070,19331783,19329330,19337448,19345247,19336401,19334913,19340801,19345501,19330719,19342518,19331004,19345176,19330572,19343877,19342323,19335979,19325391,19333277,19343810,19324766,19327015,19342943,19323123,19329208,19345087,19329083,19330356,19322669,19345349,19345137,19327264,19325715,19325710,19325331,19326838,19343351,19341162,19338765,19318898,19334550,19324417,19339956,19327183,19342616,19345487,19344039,19325573,19330262,19332376,19318341,19331347,19321270,19335537,19338525,19336684,19330955,19320136,19345357,19326637,19340906,19330898,19338188,19327939,19343973,19341286,19325570,19328019,19321366,19340872,19319215,19321124,19320607,19319489,19322834,19319233,19335539,19325302,19330608,19323844,19326663,19337550,19345074,19339447,19319284,19324373,19324971,19326631,19322711,19319499,19319695,19329862,19321521,19331725,19320117,19322998,19324604,19325436,19330632,19328552,19332665,19330974,19331525,19321218,19321900,19323753,19341849,19325074,19343970,19330986,19344861,19327351,19321333,19335833,19344325,19331068,19329120,19337365,19320505,19332490,19337107,19336972,19344735,19328635,19340484,19325561,19335279,19322518,19341448,19327612,19318464,19334936,19339597,19334918,19318685,19337252,19319110,19328962,19336217,19328637,19335853,19344458,19336924,19339328,19321074,19321637,19339723,19342601,19330351,19343632,19318498,19321034,19334781,19343435,19324941,19320608,19320270,19343240,19341572,19324260,19321217,19322651,19341247,19324586,19330476,19321262,19325556,19321609,19321963,19321044,19339954,19333068,19337749,19318939,19330882,19343604,19328533,19333351,19343491,19323483,19318649,19336613,19339738,19333836,19321619,19343167,19336559,19326544,19322729,19336197,19318523,19324878,19331385,19331313,19321330,19339716,19338075,19320553,19339964,19324198,19319317,19342061,19322953,19329264,19338019,19325293,19332987,19329679,19322628,19327146,19322356,19318707,19322842,19334738,19333077,19339634,19329018,19321387,19330431,19318379,19328016,19344230,19319935,19332721,19319555,19338021,19319273,19329572,19326070,19337780,19340049,19335235,19328341,19327168,19339813,19334573,19325679,19334683,19325251,19331912,19337900,19338507,19325371,19319160,19326147,19322345,19333563,19322183,19330142,19325811,19332842,19334828,19319880,19319795,19336041,19319325,19319601,19334974,19324441,19331277,19322260,19318312,19326973,19330044,19336512,19329723,19327251,19333549,19333505,19335608,19329490,19333220,19341768,19319579,19329137,19328350,19323979,19329603,19332285,19323159,19329468,19319456,19331565,19327340,19330634,19324211,19330382,19330358,19326994,19330057,19320293,19329533,19325236,19326555,19328828,19328780,19321120,19320941,19327805,19323833,19327687,19326224,19332608,19319246,19332249,19332242,19327079,19325119,19318281,19319603,19333919,19326622,19331065,19324528,19326388,19329703,19327929,19322887,19324531,19322035,19328382,19328274,19321388,19321059,19327943,19322707,19324985,19324582,19327149,19323885,19326662,19322342,19323084,19326130,19331148,19329171,19328547]';

    expect(parseTopStories(jsonString).first, 19347443);
  });

  test('parses item.json', () {
    const jsonString =
        '{"by":"dhouston","descendants":71,"id":8863,"kids":[9224,8917,8952,8884,8887,8869,8940,8908,8958,9005,8873,9671,9067,9055,8865,8881,8872,8955,10403,8903,8928,9125,8998,8901,8902,8907,8894,8870,8878,8980,8934,8943,8876],"score":104,"time":1175714200,"title":"My YC app: Dropbox - Throw away your USB drive","type":"story","url":"http://www.getdropbox.com/u/2/screencast.html"}';

    expect(parseArticle(jsonString).by, 'dhouston');
  });

  test('parses item.json over a network call.', () async {
    const url = 'https://hacker-news.firebaseio.com/v0/item/8863.json';
    final response = await http.get(url);
    expect(parseArticle(response.body).by, 'dhouston');
  });
}
